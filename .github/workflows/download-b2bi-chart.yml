name: Fetch IBM B2Bi Helm Chart

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Chart version (e.g., 3.0.6)'
        required: true

jobs:
  fetch-b2bi-chart:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4

    - name: Download and Extract Helm Chart
      run: |
        CHART_VERSION="${{ github.event.inputs.version }}"
        CHART_NAME="ibm-b2bi-prod-${CHART_VERSION}.tgz"
        CHART_URL="https://github.com/IBM/charts/raw/master/repo/ibm-helm/${CHART_NAME}"

        echo "Fetching chart from: $CHART_URL"
        mkdir -p ibm/b2bi
        curl -L -o /tmp/b2bi.tgz "$CHART_URL"

        echo "Extracting chart to ibm/b2bi/"
        tar -xzf /tmp/b2bi.tgz -C ibm/b2bi

    - name: Commit and Push Chart
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@users.noreply.github.com"

        git add ibm/b2bi
        git commit -m "Add IBM B2Bi Helm chart version ${{ github.event.inputs.version }}"
        git push
